!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.GLTFUtils=t():e.GLTFUtils=t()}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";r.r(t);var n=function(){function e(){this.copyright="",this.defaultScene=0,this.generator="glTF-js-utils",this._scenes=[]}return e.prototype.setDefaultScene=function(e){if("number"==typeof e)this.defaultScene=e;else{var t=this._scenes.indexOf(e);if(-1===t)throw new Error("Scene passed to setDefaultScene was not found.");this.defaultScene=t}},e.prototype.addScene=function(e){if(this._scenes.indexOf(e)>=0)throw new Error("Scene passed to addScene was added prior.");this._scenes.push(e)},e.prototype.removeScene=function(e){var t=this._scenes.indexOf(e);t>=0&&this._scenes.splice(t,1)},e.prototype.forEachScene=function(e){this._scenes.forEach(e)},e}(),o=function(){function e(){this.name="",this._nodes=[]}return e.prototype.addNode=function(e){if(this._nodes.indexOf(e)>=0)throw new Error("Node passed to addNode was added prior.");this._nodes.push(e)},e.prototype.forEachNode=function(e){this._nodes.forEach(e)},e}(),i=function(){function e(e,t,r){this.x=0,this.y=0,this.z=0,this.x=e,this.y=t,this.z=r}return e.prototype.toArray=function(){return[this.x,this.y,this.z]},e}(),s=function(){function e(e,t,r,n){this.x=e,this.y=t,this.z=r,this.w=n}return e.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]},e}();function a(e){return e*Math.PI/180}var u,f,c,h,p,l,d,m=function(){function e(){this.name="",this._nodes=[]}return e.prototype.addNode=function(e){if(this._nodes.indexOf(e)>=0)throw new Error("Node passed to addNode was added prior.");this._nodes.push(e)},e.prototype.forEachNode=function(e){this._nodes.forEach(e)},e.prototype.setTranslation=function(e,t,r){this._translation=new i(e,t,r)},e.prototype.getTranslation=function(){return this._translation||new i(0,0,0)},e.prototype.setRotationDegrees=function(e,t,r){this.setRotationRadians(a(e),a(t),a(r))},e.prototype.setRotationRadians=function(e,t,r){this._rotation=function(e,t,r){var n=Math.cos(.5*r),o=Math.sin(.5*r),i=Math.cos(.5*e),a=Math.sin(.5*e),u=Math.cos(.5*t),f=Math.sin(.5*t);return new s(n*a*u-o*i*f,n*i*f+o*a*u,o*i*u-n*a*f,n*i*u+o*a*f)}(e,t,r)},e.prototype.setRotationQuaternion=function(e,t,r,n){this._rotation=new s(e,t,r,n)},e.prototype.getRotationQuaternion=function(){return this._rotation||new s(0,0,0,1)},e.prototype.setScale=function(e,t,r){this._scale=new i(e,t,r)},e.prototype.getScale=function(){return this._scale||new i(1,1,1)},e}(),y=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();!function(e){e[e.External=0]="External",e[e.DataURI=1]="DataURI",e[e.GLB=2]="GLB"}(u||(u={})),function(e){e[e.External=0]="External",e[e.DataURI=1]="DataURI",e[e.GLB=2]="GLB"}(f||(f={})),function(e){e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT"}(c||(c={})),function(e){e.SCALAR="SCALAR",e.VEC2="VEC2",e.VEC3="VEC3",e.VEC4="VEC4",e.MAT2="MAT2",e.MAT3="MAT3",e.MAT4="MAT4"}(h||(h={})),function(e){e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(p||(p={})),function(e){e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.REPEAT=10497]="REPEAT"}(l||(l={})),function(e){e.OPAQUE="OPAQUE",e.MASK="MASK",e.BLEND="BLEND"}(d||(d={}));var _,g=function(){return function(){this.r=1,this.g=1,this.b=1}}(),v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.a=1,t}return y(t,e),t}(g);!function(e){e[e.NoColors=0]="NoColors",e[e.FaceColors=1]="FaceColors",e[e.VertexColors=2]="VertexColors"}(_||(_={}));var w=function(){function e(){this.material=[],this.mode=p.TRIANGLES,this._vertices=[],this._faceColors=[],this._materialIndices=[]}return e.prototype.addFace=function(e,t,r,n,o){this._vertices.push(e),this._vertices.push(t),this._vertices.push(r),this._faceColors.push(n),void 0===o&&(o=-1),this._materialIndices.push(o)},e.prototype.forEachFace=function(e){for(var t=0;t<this._vertices.length/3;t++)e(this._vertices[3*t],this._vertices[3*t+1],this._vertices[3*t+2],this._faceColors[t],this._materialIndices[t])},e}(),b=function(){return function(){this.name="",this.alphaCutoff=.5,this.alphaMode=d.OPAQUE,this.doubleSided=!1,this.vertexColorMode=_.NoColors,this.pbrMetallicRoughness={metallicFactor:1,roughnessFactor:1}}}(),T=function(){function e(e){this.wrapS=l.CLAMP_TO_EDGE,this.wrapT=l.CLAMP_TO_EDGE,this.image=e}return Object.defineProperty(e.prototype,"image",{get:function(){return this.__image},set:function(e){if(!e)throw new Error("Why is the texture image being unset?");this.__image=e},enumerable:!0,configurable:!0}),e}(),E=function(){return function(){this.x=0,this.y=0,this.z=0,this.u=0,this.v=0,this.normalX=0,this.normalY=0,this.normalZ=0}}();function x(e){var t=new n,r=new o;return r.name=e.name,t.addScene(r),r.addNode(function e(t){var r=new m;r.name=t.name;if(function(e){return"Mesh"===e.type}(t))r.mesh=function(e){var t=new w,r=e.geometry;if(!function(e){return"Geometry"===e.type}(r))throw new Error("BufferGeometry (or other type) not supported.");for(var n=0;n<r.faces.length;n++){var o=r.faces[n],i=new g;i.r=o.color.r,i.g=o.color.g,i.b=o.color.b,t.addFace(O(r,n,o.a,0),O(r,n,o.b,1),O(r,n,o.c,2),i,o.materialIndex)}t.material=function(e){var t=[];Array.isArray(e)||(e=[e]);for(var r=0,n=e;r<n.length;r++){var o=n[r];t.push(S(o))}return t}(e.material);return t}(t);else{r.setTranslation(t.position.x,t.position.y,t.position.z),r.setRotationRadians(t.rotation.x,t.rotation.y,t.rotation.z),r.setScale(t.scale.x,t.scale.y,t.scale.z);for(var n=0,o=t.children;n<o.length;n++){var i=o[n];r.addNode(e(i))}}return r}(e)),t}function S(e){var t=new b;if(t.doubleSided=2===e.side,!function(e){return"MeshBasicMaterial"===e.type}(e))throw new Error(e.type+" is currently not supported.");if(t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=0,e.transparent&&(t.alphaMode=d.MASK,t.alphaCutoff=e.alphaTest),t.vertexColorMode=e.vertexColors,e.color&&0===e.vertexColors&&(t.pbrMetallicRoughness.baseColorFactor=[e.color.r,e.color.g,e.color.b,1]),e.map){var r=new T(e.map.image);r.wrapS=A(e.map.wrapS),r.wrapT=A(e.map.wrapT),t.pbrMetallicRoughness.baseColorTexture=r}return t}function O(e,t,r,n){var o=new E,i=e.vertices[r];o.x=i.x,o.y=i.y,o.z=i.z,e.faceVertexUvs[0]&&e.faceVertexUvs[0][t]&&e.faceVertexUvs[0][t][n]&&(o.u=e.faceVertexUvs[0][t][n].x,o.v=e.faceVertexUvs[0][t][n].y);var s=e.faces[t];return s.vertexNormals[n]&&(o.normalX=s.vertexNormals[n].x,o.normalY=s.vertexNormals[n].y,o.normalZ=s.vertexNormals[n].z),s.vertexColors[n]&&(o.color=new g,o.color.r=s.vertexColors[n].r,o.color.g=s.vertexColors[n].g,o.color.b=s.vertexColors[n].b),o}function A(e){switch(e){case 1e3:return l.REPEAT;case 1002:return l.MIRRORED_REPEAT;case 1001:default:return l.CLAMP_TO_EDGE}}var N=function(){function e(e){this._bufferViews=[],this._finalized=!1,this._gltf=e,e.buffers||(e.buffers=[]),this._index=e.buffers.length;var t={byteLength:-1};e.buffers.push(t),this._gltfBuffer=t}return e.prototype.getIndex=function(){return this._index},e.prototype.addBufferView=function(e,t){if(this._finalizePromise)throw new Error("Cannot add buffer view after finalizing buffer");var r=new C(this,this._gltf,e,t);return this._bufferViews.push(r),r},e.prototype.getByteOffset=function(e){for(var t=0,r=0,n=this._bufferViews;r<n.length;r++){var o=n[r];if(o===e)return t;t+=o.getSize()}throw"Given bufferView was not present in this buffer"},e.prototype.getViewFinalizePromises=function(e){for(var t=[],r=0,n=this._bufferViews;r<n.length;r++){var o=n[r];if(e&&o===e)return t;t.push(o.finalized)}return t},e.prototype.getArrayBuffer=function(){if(!this._finalized)throw new Error("Cannot get ArrayBuffer from Buffer before it is finalized");for(var e=this._getTotalSize(),t=new ArrayBuffer(e),r=0,n=0,o=this._bufferViews;n<o.length;n++){var i=o[n];i.writeOutToBuffer(t,r),r+=i.getSize()}return t},e.prototype.finalize=function(){var e=this;if(this._finalizePromise)throw new Error("Buffer "+this._index+" was already finalized");return this._finalizePromise=new Promise(function(t){t(Promise.all(e.getViewFinalizePromises()))}).then(function(){e._finalized=!0;var t=e.getArrayBuffer();e._gltfBuffer.byteLength=t.byteLength,e._gltfBuffer.uri=t}),this._gltf.extras.promises.push(this._finalizePromise),this._finalizePromise},e.prototype._getTotalSize=function(){for(var e=0,t=0,r=this._bufferViews;t<r.length;t++){e+=r[t].getSize()}return e},e}(),C=function(){function e(e,t,r,n){this._data=[],this._finalized=!1,this._accessorIndex=-1,this._accessorAttr=null,this._accessorMin=null,this._accessorMax=null,this._buffer=e,this._componentType=r,this._dataType=n,t.bufferViews||(t.bufferViews=[]),this._index=t.bufferViews.length,this._gltfBufferView={buffer:e.getIndex(),byteLength:-1};var o=this._getElementSize();o>=4&&(this._gltfBufferView.byteStride=o),t.bufferViews.push(this._gltfBufferView)}return e.prototype.getIndex=function(){return this._index},e.prototype.push=function(e){var t=this._data.length;if(this._data.push(e),this._accessorIndex>=0){var r=t%this._numComponentsForDataType(),n=this._accessorMin[r];this._accessorMin[r]="number"!=typeof n?e:Math.min(n,e);var o=this._accessorMax[r];this._accessorMax[r]="number"!=typeof o?e:Math.max(o,e)}},e.prototype.getDataSize=function(){return this._data.length*this._sizeOfComponentType()},e.prototype.getSize=function(){return function(e,t){return t*Math.ceil(e/t)}(this.getDataSize(),4)},e.prototype.getByteOffset=function(){if(!this._finalized)throw new Error("Cannot get BufferView offset until it is finalized");return this._buffer.getByteOffset(this)},e.prototype.writeOutToBuffer=function(e,t){void 0===t&&(t=this.getSize());for(var r=new DataView(e,t),n=this._sizeOfComponentType(),o=0;o<this._data.length;o++){var i=this._data[o];this._writeValue(r,o*n,i)}},e.prototype.writeAsync=function(e,t){var r=this;if(void 0===t&&(t=this.getSize()),this._asyncWritePromise)throw new Error("Can't write multiple buffer view values asynchronously");return this._asyncWritePromise=e.then(function(e){for(var t=new Uint8Array(e),n=0;n<t.byteLength;n++)r._data.push(t[n]);delete r._asyncWritePromise}),this._asyncWritePromise},e.prototype.startAccessor=function(e){if(this._accessorIndex>=0)throw"Accessor was started without ending the previous one";this._accessorIndex=this._data.length,this._accessorAttr=e,this._accessorMin=new Array(this._numComponentsForDataType()),this._accessorMax=new Array(this._numComponentsForDataType())},e.prototype.endAccessor=function(){if(this._accessorIndex<0)throw"An accessor was not started, but was attempted to be ended";var e=this._getElementSize(),t=this._numComponentsForDataType(),r=(this._data.length-this._accessorIndex)/t;if(r%1)throw"An accessor was ended with missing component values";for(var n=0;n<this._accessorMin.length;n++)"number"!=typeof this._accessorMin[n]&&(this._accessorMin[n]=0),"number"!=typeof this._accessorMax[n]&&(this._accessorMax[n]=0);var o={byteOffset:e*(this._accessorIndex/t),componentType:this._componentType,count:r,type:this._dataType,min:this._accessorMin,max:this._accessorMax};switch(this._accessorAttr){case"TEXCOORD_0":case"TEXCOORD_1":case"COLOR_0":switch(this._componentType){case c.UNSIGNED_BYTE:case c.UNSIGNED_SHORT:o.normalized=!0}}return this._accessorIndex=-1,this._accessorAttr=null,this._accessorMin=null,this._accessorMax=null,o},Object.defineProperty(e.prototype,"finalized",{get:function(){var e=this;return this._finalizedPromise?this._finalizedPromise:this._finalized?this._finalizedPromise=Promise.resolve():this._finalizedPromise=new Promise(function(t){e._finalizedPromiseResolve=t})},enumerable:!0,configurable:!0}),e.prototype.finalize=function(){var e=this,t=this._gltfBufferView;return new Promise(function(t){var r=e._buffer.getViewFinalizePromises(e);e._asyncWritePromise&&r.push(e._asyncWritePromise),t(Promise.all(r))}).then(function(){e._finalized=!0,t.byteOffset=e.getByteOffset(),t.byteLength=e.getDataSize(),e._finalizedPromiseResolve&&e._finalizedPromiseResolve()})},e.prototype._getElementSize=function(){return this._sizeOfComponentType()*this._numComponentsForDataType()},e.prototype._sizeOfComponentType=function(){switch(this._componentType){case c.BYTE:case c.UNSIGNED_BYTE:return 1;case c.SHORT:case c.UNSIGNED_SHORT:return 2;case c.UNSIGNED_INT:case c.FLOAT:return 4}throw"Unrecognized component type "+this._componentType},e.prototype._numComponentsForDataType=function(){switch(this._dataType){case h.SCALAR:return 1;case h.VEC2:return 2;case h.VEC3:return 3;case h.VEC4:case h.MAT2:return 4;case h.MAT3:return 9;case h.MAT4:return 16}throw"Unsupported data type"},e.prototype._writeValue=function(e,t,r){switch(this._componentType){case c.BYTE:e.setInt8(t,r);break;case c.UNSIGNED_BYTE:e.setUint8(t,r);break;case c.SHORT:e.setInt16(t,r,!0);break;case c.UNSIGNED_SHORT:e.setUint16(t,r,!0);break;case c.UNSIGNED_INT:e.setUint32(t,r,!0);break;case c.FLOAT:e.setFloat32(t,r,!0);break;default:throw"Unsupported data type"}},e}();function M(e){var t,r,n=R(e),o=new Promise(function(e,n){t=e,r=n});return n.toBlob(function(e){if(e){var n=new FileReader;n.addEventListener("loadend",function(){t(n.result)}),n.readAsArrayBuffer(e)}else r("Unable to convert image to PNG")},"image/png"),o}function R(e){var t;e instanceof HTMLImageElement?((t=document.createElement("canvas")).width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0,e.width,e.height)):t=e;return t}function I(e,t){e.scene=t.defaultScene;var r=e.extras.options.bufferOutputType===u.GLB||e.extras.options.imageOutputType===f.GLB;r&&(e.extras.binChunkBuffer=z(e)),t.forEachScene(function(t){!function(e,t){e.scenes||(e.scenes=[]);var r={};t.name&&(r.name=t.name);t.forEachNode(function(t){r.nodes||(r.nodes=[]);var n=function e(t,r){t.nodes||(t.nodes=[]);var n={};r.name&&(n.name=r.name);var o=r.getTranslation();0===o.x&&0===o.y&&0===o.z||(n.translation=o.toArray());var i=r.getRotationQuaternion();0===i.x&&0===i.y&&0===i.z&&1===i.w||(n.rotation=i.toArray());var s=r.getScale();1===s.x&&1===s.y&&1===s.z||(n.scale=s.toArray());var a=t.nodes.length;t.nodes.push(n);r.mesh?n.mesh=function(e,t){e.meshes||(e.meshes=[]);if(t.mode!==p.TRIANGLES)throw"MeshMode other than TRIANGLES not currently supported";!function(e,t){for(var r=[],n=0,o=t;n<o.length;n++){var i=o[n];r.push(P(e,i))}}(e,t.material);var r={primitives:[]},n=e.meshes.length;e.meshes.push(r);var o,i=e.extras.options.bufferOutputType===u.GLB;o=i?e.extras.binChunkBuffer:z(e);var s,a=o.addBufferView(c.FLOAT,h.VEC3),f=o.addBufferView(c.FLOAT,h.VEC3),l=o.addBufferView(c.FLOAT,h.VEC2);function d(r){var n=a.endAccessor(),o=f.endAccessor(),i=l.endAccessor(),u={attributes:{POSITION:B(e,a.getIndex(),n),NORMAL:B(e,f.getIndex(),o),TEXCOORD_0:B(e,l.getIndex(),i)},mode:t.mode};if(r>=0){u.material=r;var c=t.material[r];if(c.vertexColorMode!==_.NoColors){var h=s.endAccessor();u.attributes.COLOR_0=B(e,s.getIndex(),h)}}return u}var m=null;if(t.forEachFace(function(e,n,i,u,p){var y=null;if(p>=0&&(y=t.material[p]),m!==p){if(null!==m){var v=d(m);r.primitives.push(v)}a.startAccessor("POSITION"),f.startAccessor("NORMAL"),l.startAccessor("TEXCOORD_0"),y&&y.vertexColorMode!==_.NoColors&&(s||(s=o.addBufferView(c.UNSIGNED_BYTE,h.VEC4)),s.startAccessor("COLOR_0")),m=p}if(a.push(e.x),a.push(e.y),a.push(e.z),a.push(n.x),a.push(n.y),a.push(n.z),a.push(i.x),a.push(i.y),a.push(i.z),f.push(e.normalX),f.push(e.normalY),f.push(e.normalZ),f.push(n.normalX),f.push(n.normalY),f.push(n.normalZ),f.push(i.normalX),f.push(i.normalY),f.push(i.normalZ),l.push(e.u),l.push(e.v),l.push(n.u),l.push(n.v),l.push(i.u),l.push(i.v),y)switch(y.vertexColorMode){case _.FaceColors:for(var w=0;w<3;w++)L(s,u||new g);break;case _.VertexColors:L(s,e.color||new g),L(s,n.color||new g),L(s,i.color||new g)}}),null!==m){var y=d(m);r.primitives.push(y)}a.finalize(),f.finalize(),l.finalize(),s&&s.finalize();i||o.finalize();return n}(t,r.mesh):r.forEachNode(function(r){n.children||(n.children=[]);var o=e(t,r);n.children.push(o)});return a}(e,t);r.nodes.push(n)}),e.scenes.push(r)}(e,t)}),r&&e.extras.binChunkBuffer.finalize()}function L(e,t){e.push(255*t.r|0),e.push(255*t.g|0),e.push(255*t.b|0),"a"in t?e.push(255*t.a|0):e.push(255)}function z(e){return new N(e)}function B(e,t,r){e.accessors||(e.accessors=[]);var n=e.accessors.length,o=r.componentType,i={bufferView:t,byteOffset:r.byteOffset,componentType:o,count:r.count,type:r.type,min:r.min,max:r.max};return r.normalized&&(i.normalized=!0),e.accessors.push(i),n}function P(e,t){e.materials||(e.materials=[]);var r={};if(t.name&&(r.name=t.name),t.alphaMode!==d.OPAQUE&&(r.alphaMode=t.alphaMode),.5!==t.alphaCutoff&&(r.alphaCutoff=t.alphaCutoff),t.doubleSided&&(r.doubleSided=!0),t.pbrMetallicRoughness&&(t.pbrMetallicRoughness.baseColorFactor&&(r.pbrMetallicRoughness={},r.pbrMetallicRoughness.baseColorFactor=t.pbrMetallicRoughness.baseColorFactor),t.pbrMetallicRoughness.baseColorTexture)){r.pbrMetallicRoughness||(r.pbrMetallicRoughness={});var n=function(e,t){e.textures||(e.textures=[]);var r={sampler:function(e,t){e.samplers||(e.samplers=[]);for(var r={wrapS:t.wrapS,wrapT:t.wrapT},n=0;n<e.samplers.length;n++)if(G(r,e.samplers[n]))return n;var o=e.samplers.length;return e.samplers.push(r),o}(e,t),source:function(e,t){e.images||(e.images=[]);for(var r=0;r<e.images.length;r++)if(t===e.images[r].extras)return r;var n={extras:t};switch(e.extras.options.imageOutputType){case f.GLB:var o=e.extras.binChunkBuffer.addBufferView(c.UNSIGNED_BYTE,h.SCALAR);o.writeAsync(M(t)).then(function(){o.finalize()}),n.bufferView=o.getIndex(),n.mimeType="image/png";break;case f.DataURI:n.uri=function(e){return R(e).toDataURL()}(t);break;default:e.extras.promises.push(M(t).then(function(e){n.uri=e}))}var i=e.images.length;return e.images.push(n),i}(e,t.image)},n=e.textures.length;return e.textures.push(r),n}(e,t.pbrMetallicRoughness.baseColorTexture);r.pbrMetallicRoughness.baseColorTexture={index:n}}var o=e.materials.length;return e.materials.push(r),o}function G(e,t){return JSON.stringify(e)===JSON.stringify(t)}var V,D=12,U=8,F=1179937895,j=2;function k(e,t){if(!e)throw new Error("GLB requires a JSON glTF chunk");var r=D;r+=U;var n=function(e){return(new TextEncoder).encode(e).buffer}(e);if(r+=H(n.byteLength,4),t&&(r+=U,r+=t.byteLength,t.byteLength%4))throw new Error("Expected BIN chunk length to be divisible by 4 at this point");var o=new ArrayBuffer(r),i=new DataView(o);!function(e,t){e.setUint32(0,F,!0),e.setUint32(4,j,!0),e.setUint32(8,t,!0)}(i,r);var s=Y(i,n,12,V.JSON,32);return t&&Y(i,t,s,V.BIN),o}function Y(e,t,r,n,o){void 0===o&&(o=0);var i=H(t.byteLength,4);for(e.setUint32(r,i,!0),e.setUint32(r+=4,n,!0),function(e,t,r,n,o){new Uint8Array(e,r,o).set(new Uint8Array(t,n,o),0)}(e.buffer,t,r+=4,0,t.byteLength),r+=t.byteLength;r%4;)o&&e.setUint8(r,o),r++;return r}function H(e,t){return t*Math.ceil(e/t)}!function(e){e[e.JSON=1313821514]="JSON",e[e.BIN=5130562]="BIN"}(V||(V={})),r.d(t,"exportGLTF",function(){return W}),r.d(t,"exportGLTFZip",function(){return J}),r.d(t,"exportGLB",function(){return Z}),r.d(t,"GLTFAsset",function(){return n}),r.d(t,"Scene",function(){return o}),r.d(t,"Node",function(){return m}),r.d(t,"Mesh",function(){return w}),r.d(t,"Material",function(){return b}),r.d(t,"Texture",function(){return T}),r.d(t,"Vertex",function(){return E}),r.d(t,"XYZPair",function(){return i}),r.d(t,"Quaternion",function(){return s}),r.d(t,"glTFAssetFromTHREE",function(){return x}),r.d(t,"AlphaMode",function(){return d}),r.d(t,"ComponentType",function(){return c}),r.d(t,"DataType",function(){return h}),r.d(t,"MeshMode",function(){return p}),r.d(t,"RGBColor",function(){return g}),r.d(t,"RGBAColor",function(){return v}),r.d(t,"VertexColorMode",function(){return _}),r.d(t,"WrappingMode",function(){return l}),r.d(t,"ImageOutputType",function(){return f}),r.d(t,"BufferOutputType",function(){return u});var X="model.gltf",Q="model.glb";function W(e,t){t=t||{};var r={asset:{version:"2.0",copyright:e.copyright,generator:e.generator},extras:{options:t,binChunkBuffer:null,promises:[]}};I(r,e);var n=r.extras.promises,o=1,i=1,s=null;return Promise.all(n).then(function(){var e={};delete r.extras;var n="number"==typeof t.jsonSpacing?t.jsonSpacing:4,a=JSON.stringify(r,function(r,n){if("extras"!==r){if(n instanceof ArrayBuffer){if(function(e){if(e.byteLength<8)return!1;var t=new Uint8Array(e);return 137===t[0]&&80===t[1]&&78===t[2]&&71===t[3]&&13===t[4]&&10===t[5]&&26===t[6]&&10===t[7]}(n))switch(t.imageOutputType){case f.DataURI:case f.GLB:break;default:var a="img"+i+".png";return i++,e[a]=n,a}switch(t.bufferOutputType){case u.DataURI:return function(e){for(var t=[],r=new Uint8Array(e),n=0;n<r.length;n++)t.push(String.fromCharCode(r[n]));return"data:application/octet-stream;base64,"+btoa(t.join(""))}(n);case u.GLB:if(s)throw new Error("Already encountered an ArrayBuffer, there should only be one in the GLB format.");return void(s=n);default:a="data"+o+".bin";return o++,e[a]=n,a}}return n}},n);return t.bufferOutputType===u.GLB||t.imageOutputType===f.GLB?e[Q]=k(a,s):e[X]=a,e})}function J(e,t,r){return W(e,r).then(function(e){var r=new t;for(var n in e)r.file(n,e[n]);return r.generateAsync({type:"blob"})})}function Z(e){return W(e,{bufferOutputType:u.GLB,imageOutputType:f.GLB,jsonSpacing:0}).then(function(e){return e[Q]})}}])});